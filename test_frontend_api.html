<!DOCTYPE html>
<html>
<head>
    <title>Frontend API Test</title>
</head>
<body>
    <h1>Password Reset Frontend API Test</h1>
    <div id="output"></div>
    
    <script>
        const log = (message) => {
            console.log(message);
            document.getElementById('output').innerHTML += message + '<br>';
        };

        // Simulate the exact frontend API configuration
        const api = {
            defaults: { baseURL: 'http://localhost:8081/api' },
            post: async (url, data) => {
                const fullUrl = api.defaults.baseURL + url;
                log(`üîß Making request to: ${fullUrl}`);
                log(`üîß Payload: ${JSON.stringify(data)}`);
                
                try {
                    const response = await fetch(fullUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    
                    log(`üîß Response status: ${response.status}`);
                    const result = await response.text();
                    log(`üîß Response data: ${result}`);
                    
                    return { data: result, status: response.status };
                } catch (error) {
                    log(`üîß Error: ${error.message}`);
                    throw error;
                }
            }
        };

        // Simulate the exact setNewPassword function from authApi.ts
        const setNewPassword = async (email, code, newPassword) => {
            log("üîß ===== setNewPassword API CALL START =====");
            log(`üîß Email: ${email}`);
            log(`üîß Code: ${code}`);
            log(`üîß New password length: ${newPassword.length}`);
            log(`üîß API base URL: ${api.defaults.baseURL}`);
            log(`üîß Full URL: ${api.defaults.baseURL}/auth/password-reset/set-new-password`);
            
            const payload = { email, code, newPassword };
            log(`üîß Payload: ${JSON.stringify(payload)}`);
            
            try {
                log("üîß Making API request...");
                const response = await api.post('/auth/password-reset/set-new-password', payload);
                log("üîß ‚úÖ API SUCCESS!");
                log(`üîß Response data: ${response.data}`);
                log(`üîß Response status: ${response.status}`);
                log("üîß ===== setNewPassword API CALL END (SUCCESS) =====");
                return response.data;
            } catch (error) {
                log("üîß ‚ùå API ERROR!");
                log(`üîß Error object: ${error}`);
                log(`üîß Error message: ${error.message}`);
                log("üîß ===== setNewPassword API CALL END (ERROR) =====");
                throw error;
            }
        };

        // Auto-run test
        window.onload = async () => {
            log("üß™ Starting Frontend API Test...");
            
            try {
                // Test with known working values
                const result = await setNewPassword('test@jobdam.com', '566743', 'browsertest123');
                log(`‚úÖ SUCCESS: ${result}`);
            } catch (error) {
                log(`‚ùå FAILED: ${error.message}`);
            }
        };
    </script>
</body>
</html>